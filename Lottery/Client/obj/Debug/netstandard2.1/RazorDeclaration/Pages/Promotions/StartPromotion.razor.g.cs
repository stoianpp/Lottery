#pragma checksum "E:\Code\Blazor\Lottery\Lottery\Client\Pages\Promotions\StartPromotion.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "ab958fc7d733617fed3a96d8f521a4d99dba353a"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace Lottery.Client.Pages.Promotions
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Lottery.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Lottery.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Lottery.Client.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Lottery.Shared.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Lottery.Client.Repository;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Lottery.Shared.DTOs;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\Code\Blazor\Lottery\Lottery\Client\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\Code\Blazor\Lottery\Lottery\Client\Pages\Promotions\StartPromotion.razor"
using System.Timers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\Code\Blazor\Lottery\Lottery\Client\Pages\Promotions\StartPromotion.razor"
           [Authorize]

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/promotion/start/{PromotionId:int}")]
    public partial class StartPromotion : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 56 "E:\Code\Blazor\Lottery\Lottery\Client\Pages\Promotions\StartPromotion.razor"
       
    [Parameter] public int PromotionId { get; set; }

    private Promotion Promotion;
    private List<Gift> SelectedGifts;
    private Dictionary<int, int> SelectedGiftsNumber;
    private string stop;
    private string execute;
    private int counter;
    private Gift currentGift;
    private List<int> totalDraws;
    private bool isRolling;
    private string title;
    private string titleColor;
    Timer timer;
    Random random;

    protected async override Task OnInitializedAsync()
    {
        var model = await promotionRepository.GetPromotionForUpdate(PromotionId);
        title = "PRESS THE IMAGE TO DRAW!";
        titleColor = "black";
        Promotion = model.Promotion;
        SelectedGifts = model.SelectedGifts;
        SelectedGiftsNumber = new Dictionary<int, int>();
        totalDraws = new List<int>();
        currentGift = SelectedGifts[0];

        random = new Random();

        stop = "none";
        execute = "block";

        counter = 0;

        foreach (var item in SelectedGifts)
        {
            SelectedGiftsNumber.Add(item.Id, 1);
        }

        timer = new Timer();
        timer.Interval = 30;
        timer.Elapsed += TimerOnElapsed;
    }

    private void TimerOnElapsed(object sender, ElapsedEventArgs e)
    {
        counter = random.Next(0,totalDraws.Count);
        currentGift = SelectedGifts.FirstOrDefault(x => x.Id == totalDraws[counter]);
        StateHasChanged();
    }

    private void Execute()
    {
        totalDraws.Clear();
        counter = 0;
        isRolling = true;

        foreach (var item in SelectedGiftsNumber)
        {
            var arr = new int[item.Value];
            Array.Fill(arr,item.Key);
            totalDraws.AddRange(arr);
        }

        execute = "none";
        stop = "block";
        timer.Start();
    }

    private void Stop()
    {
        stop = "none";
        execute = "block";
        timer.Stop();
        title = "PRESS THE IMAGE TO DRAW!";
        titleColor = "black";
    }

    private void Pause()
    {
        if (isRolling)
        {
            timer.Stop();
            isRolling = !isRolling;
            title = "YOU WON: " + currentGift.Name;
            titleColor = "green";
        }
        else
        {
            timer.Start();
            isRolling = !isRolling;
            title = "PRESS THE IMAGE TO DRAW!";
            titleColor = "black";
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager navigationManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IPromotionRepository promotionRepository { get; set; }
    }
}
#pragma warning restore 1591
